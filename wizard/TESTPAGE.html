<!DOCTYPE HTML>
<html>
	<head>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script id="jsonData" type="text/javascript" src="jsonData.js"></script>
	</head>
  <body class="bodyClass">
    <table class="pageTable">
      <tr class="titleRow">
        <td>1</td>
        <td>2</td>
        <td>3</td>
      </tr>
      <tr class="contentRow">
        <td>4</td>
        <td class="pageCenterColumn" style="vertical-align: top;">

          <div id="app">

            <!-- subpages START -->

            <div v-show="page1">

              <table>
                <tr class="pX-navigationTopRow">
                  <td colspan="1"></td>
                  <td colspan="2" style="text-align: right;">
                    <br>
                    <p>
                      Decide for module(s) in every step and drag the desired modules from the pool fields into their corresponding selection fields.<br>
                      If the selection field contains the allowed amount of modules, it changes its color to blue. Else, the color is red.<br>
                      If <i> every single selection field </i> reaches the allowed amount of modules, the user can proceed.<br>
                    </p>
                  </tr>
                <tr>
                  <td class="pX-navigationCol">

                  </td>
                  <td class="p1-contentTableCell">
                    <div id="page1" align="center">

                    <table class="p1-contentTable" border="0px solid black">
                      <tr>
                        <td colspan="6">

                          <div>
                            <!-- The Paired-End-Single-End switch table -->
                            <table style="" class="p1-titleRow" align="center">
                              <tr
                                class="SPEInternalRow">
                                <td>
                                  Single End
                                </td>
                                <td>
                                  <label class="switch">
                                    <input type="checkbox" @click="changeEnd()">
                                    <span class="slider round"></span>
                                  </label>
                                </td>
                                <td>
                                  Paired End
                                </td>
                              </tr>
                            </table>
                            <!-- Table END -->
                          </div>
                          <br>

                        </td>
                      </tr>
                      <tr class="p1-titleRow">
                        <td class="p1PreprocessingColumn">
                          preprocessing
                        </td>
                        <td class="p1PremappingColumn">
                        </td>
                        <td class="p1-arrowCell"></td>
                        <td class="p1MappingColumn">
                          mapping
                        </td>
                        <td class="p1-arrowCell"></td>
                        <td class="p1AnalysisColumn">
                          analysis
                        </td>
                      </tr>
                      <tr class="p1-selectionRow">
                        <td class="p1PreprocessingColumn p1-mainRowCell"
                            v-bind:class="{'p1-backgroundPipelineTrue': this.page1Acceptability, 'p1-backgroundPipelineFalse': !this.page1Acceptability}">
                          <div id="selection--0" ondrop="dropSection(event)" ondragover="allowDrop(event)"
                               class="selection moduleField moduleWellShadow well well-sm"
                               v-bind:class="{'selectionTrue': this.dynamicGroupList[0].selectionAcceptability, 'selectionFalse': !this.dynamicGroupList[0].selectionAcceptability,
                           'moduleField': !this.dynamicGroupList[0].groupChosen, 'moduleFieldGlowing': this.dynamicGroupList[0].groupChosen }">
                          </div>
                        </td>

                        <td class="p1PremappingColumn p1-arrowCell p1-mainRowCell"
                            v-bind:class="{'p1-backgroundPipelineTrue': this.page1Acceptability, 'p1-backgroundPipelineFalse': !this.page1Acceptability}">
                          <div class="p1-arrowSymbol">&#8594;</div>
                        </td>
                        <td class="p1-arrowCell p1-backgroundPipeline">
                          <!--<div class="p1-arrowSymbol">&#8594;</div>-->
                        </td>

                        <td class="p1MappingColumn p1-mainRowCell"
                            v-bind:class="{'p1-backgroundPipelineTrue': this.page1Acceptability, 'p1-backgroundPipelineFalse': !this.page1Acceptability}">
                          <div id="selection--2" ondrop="dropSection(event)" ondragover="allowDrop(event)"
                               class="selection moduleField moduleWellShadow well well-sm"
                               v-bind:class="{'selectionTrue': this.dynamicGroupList[2].selectionAcceptability, 'selectionFalse': !this.dynamicGroupList[2].selectionAcceptability,
                           'moduleField': !this.dynamicGroupList[2].groupChosen, 'moduleFieldGlowing': this.dynamicGroupList[2].groupChosen }">
                          </div>
                        </td>
                        <td class="p1-arrowCell p1-mainRowCell"
                            v-bind:class="{'p1-backgroundPipelineTrue': this.page1Acceptability, 'p1-backgroundPipelineFalse': !this.page1Acceptability}">
                          <div class="p1-arrowSymbol">&#8594;</div>
                        </td>

                        <td class="p1AnalysisColumn p1-mainRowCell"
                            v-bind:class="{'p1-backgroundPipelineTrue': this.page1Acceptability, 'p1-backgroundPipelineFalse': !this.page1Acceptability}">
                          <div id="selection--3" ondrop="dropSection(event)" ondragover="allowDrop(event)"
                               class="selection moduleField moduleWellShadow well well-sm"
                               v-bind:class="{'selectionTrue': this.dynamicGroupList[3].selectionAcceptability, 'selectionFalse': !this.dynamicGroupList[3].selectionAcceptability,
                           'moduleField': !this.dynamicGroupList[3].groupChosen, 'moduleFieldGlowing': this.dynamicGroupList[3].groupChosen }">
                          </div>
                        </td>
                      </tr>
                      <tr class="p1-titleRow">
                        <td v-bind:class="{'p1-backgroundPipelineTrue': this.page1Acceptability, 'p1-backgroundPipelineFalse': !this.page1Acceptability}"></td>
                        <td>premapping</td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                      </tr>
                      <tr class="p1-preMappingRow">
                        <td class="p1-preprocessingColumn p1-backgroundPipelinePremappingCurve"
                            v-bind:class="{'p1-backgroundPipelineTrue': this.page1Acceptability, 'p1-backgroundPipelineFalse': !this.page1Acceptability}">
                          <!--                      <p class="p1-pipelineArrow p1-arrowSymbol p1-PREM-pipelineArrowCurved">â¤´</p>-->
                        </td>
                        <td class="p1-premappingColumn"
                            v-bind:class="{'p1-backgroundPipelineTrue': this.page1Acceptability, 'p1-backgroundPipelineFalse': !this.page1Acceptability}">
                          <div id="selection--1" ondrop="dropSection(event)" ondragover="allowDrop(event)"
                               class="selection moduleField moduleWellShadow well well-sm"
                               v-bind:class="{'selectionTrue': this.dynamicGroupList[1].selectionAcceptability, 'selectionFalse': !this.dynamicGroupList[1].selectionAcceptability,
                           'moduleField': !this.dynamicGroupList[1].groupChosen, 'moduleFieldGlowing': this.dynamicGroupList[1].groupChosen }">
                          </div>
                        </td>
                        <td class="p1-arrowCell"></td>
                        <td class="p1-mappingColumn"></td>
                        <td class="p1-arrowCell"></td>
                        <td class="p1AnalysisColumn"></td>
                      </tr>
                      <tr class="p1-poolRow">
                        <td id="p1-poolCell--0" class="p1-PreprocessingColumn p1-poolCell--0">
                          <div id="pool--0" class="pool moduleField moduleWellShadow well well-sm" ondrop="dropSection(event)" ondragover="allowDrop(event)">
                            <button v-for="module in this.dynamicGroupList[0].modules" type="button" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)" ondragover="forbidDrop(event)"
                                    :id="module.id"
                                    class="p1-moduleButton"
                                    v-bind:class="{'installed': module.installed, 'noninstalled': !module.installed}">{{ module.name }}</button>
                          </div>
                        </td>
                        <td class="p1-PremappingColumn p1-poolCell--1">
                          <div id="pool--1" class="pool moduleField moduleWellShadow well well-sm" ondrop="dropSection(event)" ondragover="allowDrop(event)">
                            <button v-for="module in this.dynamicGroupList[1].modules" type="button" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)" ondragover="forbidDrop(event)"
                                    :id="module.id"
                                    class="p1-moduleButton"
                                    v-bind:class="{'installed': module.installed, 'noninstalled': !module.installed}">{{ module.name }}</button>
                          </div>
                        </td>
                        <td></td>
                        <td class="p1-MappingColumn p1-poolCell--2">
                          <div id="pool--2" class="pool moduleField moduleWellShadow well well-sm" ondrop="dropSection(event)" ondragover="allowDrop(event)">
                            <button v-for="module in this.dynamicGroupList[2].modules" type="button" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)" ondragover="forbidDrop(event)"
                                    :id="module.id"
                                    class="p1-moduleButton"
                                    v-bind:class="{'installed': module.installed, 'noninstalled': !module.installed}">{{ module.name }}</button>
                          </div>
                        </td>
                        <td></td>
                        <td class="p1-AnalysisColumn p1-poolCell--3">
                          <div id="pool--3" class="pool moduleField moduleWellShadow well well-sm" ondrop="dropSection(event)" ondragover="allowDrop(event)">
                            <button v-for="module in this.dynamicGroupList[3].modules" type="button" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)" ondragover="forbidDrop(event)"
                                    :id="module.id"
                                    class="p1-moduleButton"
                                    v-bind:class="{'installed': module.installed, 'noninstalled': !module.installed}">{{ module.name }}</button>
                          </div>
                        </td>
                      </tr>
                    </table>

                    <p></p>
                  </div>
                  </td>
                  <td class="pX-navigationCol">
                    <button :disabled="!this.page1Acceptability" type="button" class="btn btn-basic button navigationButton" onclick="collectModules()" @click="switchPage('page2')">
                      <b> module options </b>
                      <i class="fas fa-arrow-circle-right"></i>
                    </button>
                  </td>
                </tr>
              </table>

            </div>
            <div v-show="page2">
              <table class="pX-navigationTopRow">
                <tr class="pX-navigationTopRow">
                  <td colspan="1"></td>
                  <td colspan="2" style="text-align: right;">
                    <br>
                    <p>
                      Some different text for page 2 <br>
                    </p>
                </tr>
                <tr>
                  <td class="pX-navigationCol">
                    <button :disabled="!this.page1Acceptability" type="button" class="btn btn-basic button navigationButton" @click="switchPage('page1')">
                      <i class="fas fa-arrow-circle-left"></i>
                      <b> module selection </b>
                    </button><p></p>
                  </td>
                  <td class="p2-contentTableCell">

                    <div id="page2" align="center">

                      <table class="p2-moduleOptionsTable">
                        <tr>
                          <template v-for="(group, index) in collectedModules">
                            <td class="p2-pipelineGroupCol">

                              <div class="p2-pipelineGroupColWrapper">
                                <table v-bind:class="{'p2-groupTable': group.moduleAmount > 0, 'p2-emptyGroupTable': group.moduleAmount === 0}">
                                  <tr class="p2-groupTableTitleRow">

                                    <td class="p2-groupTableTitleCell">
                                      {{ group.groupName }}
                                    </td>

                                  </tr>
                                  <tr class="p2-groupTableContentRow">

                                    <td class="p2-groupTableContentCell">
                                      <div class="moduleWellShadow well well-sm">

                                        <template v-if="group.moduleAmount > '0'">
                                          <template v-for="module in group.modules">

                                            <!-- module table START -->

                                            <table class="p2-moduleTable" border="0px solid black">
                                              <tr class="p2-moduleTableTitle"
                                                  v-bind:class="{'p2-moduleTitleFalse': !module.Acceptability, 'p2-moduleTitleTrue': module.Acceptability}">
                                                <td colspan="3">
                                                  {{ module.name }}
                                                </td>
                                              </tr>
                                              <template v-if="module.settings">

                                                <template v-if="module.settings.required">
                                                  <tr class="p2-settingRow">
                                                    <td colspan="3" class="p2-settingsTypeTitle p2-typeRequiredTitle">
                                                      <div>required settings</div>
                                                    </td>
                                                  </tr>
                                                  <template v-for="(roption, index) in module.settings.required">
                                                    <tr class="p2-settingRow p2-requiredRow"
                                                        v-bind:class="{'p2-settingRowType-A': index%2 == 0, 'p2-settingRowType-B': index%2 != 0}">
                                                      <td class="p2-nameCell p2-requiredNameCell">
                                                        <div v-if="roption.showName">{{ roption.showName }}</div>
                                                        <div else>{{ roption.name }}</div>
                                                      </td>
                                                      <td class="p2-inputCell p2-requiredInputCell">
                                                        <div class="p2-invisibleContent">
                                                          <div v-if="roption.type === 'string'">
                                                            <input v-model="roption.value" type="text" class="p2-settingsInput">
                                                          </div>
                                                          <div v-if="roption.type === 'file'">
                                                            <input type="file" class="p2-settingsInput">
                                                            <input v-model="roption.value" class="p2-settingsInput" type="text" placeholder="paste file path">
                                                          </div>
                                                          <div v-if="roption.type === 'enum'">
                                                            <select v-model="roption.value" class="p2-settingsInput">
                                                              <option class="p2-enumSettingsInput" v-for="(choice, index) in roption.choices" :value="choice">{{ index }}</option>
                                                            </select>
                                                          </div>
                                                        </div>
                                                      </td>
                                                      <td class="p2-descriptionCell p2-requiredDescriptionCell">
                                                        <template v-if="roption.description">
                                                          <i class="fas fa-question-circle p2-descriptionSymbol p2-invisibleContent"
                                                             :title="roption.description"></i>
                                                        </template>
                                                      </td>
                                                    </tr>
                                                  </template>
                                                </template>

                                                <template v-if="module.settings.optional">
                                                  <tr class="p2-settingRow">
                                                    <td colspan="3" class="p2-settingsTypeTitle p2-typeOptionalTitle">
                                                      <button style="background-color: lightgrey; border: 0px; width: 100%; height: 100%" @click="changeShowOptionalSettings(module)">
                                                        <template v-if="module.showOptionalSettings === true">
                                                          <div>optional settings <i class='fas'>&#xf106;</i></div>
                                                        </template>
                                                        <template v-else>
                                                          <div>optional settings <i class='fas'>&#xf107;</i></div>
                                                        </template>
                                                      </button>
                                                    </td>
                                                  </tr>
                                                  <template v-if="module.showOptionalSettings">
                                                    <template v-for="(ooption, index) in module.settings.optional">
                                                      <tr class="p2-settingRow p2-optionalRow"
                                                          v-bind:class="{'p2-settingRowType-A': index%2 == 0, 'p2-settingRowType-B': index%2 != 0}">
                                                        <td class="p2-nameCell p2-optionalNameCell">
                                                          <div v-if="ooption.showName">{{ ooption.showName }}</div>
                                                          <div else>{{ ooption.name }}</div>
                                                        </td>
                                                        <td class="p2-inputCell p2-optionalInputCell">
                                                          <div class="p2-invisibleContent">
                                                            <div v-if="ooption.type === 'string'">
                                                              <input v-model="ooption.value" type="text" class="p2-settingsInput">
                                                            </div>
                                                            <div v-if="ooption.type === 'file'">
                                                              <input type="file" class="p2-settingsInput">
                                                              <input v-model="ooption.value" class="p2-settingsInput" type="text" placeholder="paste file path">
                                                            </div>
                                                            <div v-if="ooption.type === 'enum'">
                                                              <select v-model="ooption.value" class="p2-settingsInput">
                                                                <option v-for="(choice, index) in ooption.choices" :value="choice">{{ index }}</option>
                                                              </select>
                                                            </div>
                                                          </div>
                                                        </td>
                                                        <td class="p2-descriptionCell p2-optionalDescriptionCell">
                                                          <template v-if="ooption.description">
                                                            <i class="fas fa-question-circle p2-descriptionSymbol p2-invisibleContent"
                                                               :title="ooption.description"></i>
                                                          </template>
                                                        </td>
                                                      </tr>
                                                    </template>
                                                  </template>
                                                </template>

                                              </template>
                                              <template v-else>
                                                <tr>
                                                  <td colspan="2">
                                                    <i>(no options for this module recognized)</i>
                                                  </td>
                                                </tr>
                                              </template>
                                            </table>

                                            <!-- module table END -->
                                            <br>

                                          </template>
                                        </template>
                                        <template v-else>
                                          no module chosen
                                        </template>

                                      </div>
                                    </td>

                                  </tr>
                                </table>
                              </div>

                            </td>
                          </template>
                        </tr>
                      </table>

                      <p></p>
                    </div>

                  </td>
                  <td class="pX-navigationCol">
                    <button :disabled="!this.page2Acceptability" type="button" class="btn btn-basic button navigationButton" @click="switchPage('page3'); prepareFinalYaml()">
                      <b> final yaml </b>
                      <i class="fas fa-arrow-circle-right"></i>
                    </button>
                  </td>
                </tr>
              </table>

            </div>
            <div v-show="page3">
              <table>
                <tr class="pX-navigationTopRow">
                  <td colspan="1"></td>
                  <td colspan="2" style="text-align: right;">
                    And finally some text for the last page (page 3) <br>
                  </td>
                </tr>
                <tr>
                  <td class="pX-navigationCol">
                    <button :disabled="!this.page1Acceptability" type="button" class="btn btn-basic button navigationButton" @click="switchPage('page2')">
                      <i class="fas fa-arrow-circle-left"></i>
                      <b> module options </b>
                    </button><p></p>
                  </td>
                  <td class="p3-contentTableCell">

                    <div id="page3" align="center">
                      <div class="p3-mainTableWell well well-sm">
                        <table class="p3-mainTable">
                          <tr>
                            <td style="width: 70rem;" class="p3-mainTableCell">
                              <div id="yamlTextWell" class="well well-sm p3-finalYamlWell clickForHighlighting">
                                <template v-for="(group, index) in this.finalYaml">
                                  {{ index }} <br>
                                  <template v-for="(module, index) in group">
                                    <template v-if="index === 'modules'">
                                      &nbsp;&nbsp;{{ index }}: {{ module }} <br><br>
                                    </template>
                                    <template v-else-if="index === 'module' || index === 'paired_end'">
                                      &nbsp;&nbsp;{{ index }}: "{{ module }}" <br><br>
                                    </template>
                                    <template v-else>
                                      <template v-if="Object.keys(module).length > 0">
                                        &nbsp;&nbsp;{{ index }}: <br>
                                        <template v-for="(option, index) in module">
                                          &nbsp;&nbsp;&nbsp;&nbsp;{{ index }}: "{{ option }}"<br>
                                        </template>
                                        <br>
                                      </template>
                                    </template>
                                  </template>
                                </template>
                              </div>
                            </td>
                            <td style="width: 20rem;" class="p3-mainTableCell p3-buttonGroup">
                              <button type="button" class="btn btn-primary button" onclick="copyToClipboard()">
                                <b>Copy to Clipboard</b>
                              </button>
                              <br>
                              <button :disabled="!this.page1Acceptability" type="button" class="btn btn-primary button" style="width: 100%;" onclick="download(VUE.finalYaml, 'dge-pipeline.yaml', 'yaml')">
                                <i style="font-size: 4rem;" class="fas fa-file-download"></i>
                                <br>
                                <b> download YAML </b>
                              </button><p></p>
                            </td>
                          </tr>
                        </table>
                      </div>
                    </div>

                  </td>
                  <td class="pX-navigationCol"></td>
                </tr>
              </table>
            </div>

            <!-- subpages END -->

          </div>

        </td>
        <td>6</td>
      </tr>
    </table>
  </body>
</html>

<style>
  /* global Styles */

  /*.testCol {*/
  /*  transform: scale(0.5)*/
  /*}*/
  /*.testCol:hover {*/
  /*  transform: scale(1.0);*/
  /*}*/

  .testcol--0 {
    background-color: red;
  }
  .testCol--0:hover {
    transform: scale(1.2)
  }
  html {
    height: 100%;
    width: 100%;
    overflow: -moz-scrollbars-vertical;
    overflow-y: scroll;
  }
  .bodyClass {
    height: 100%;
    /*background-image: linear-gradient(to bottom, white, #8cbdea);*/
    background-color: #b2dcff;
  }
  .pageTable {
    width: 100%;
    height: 100%;
    text-align: center;
  }
  .pageCenterColumn {
    /*background-color: rgba(255, 255, 255, 0.25);*/
    background-image: linear-gradient(to bottom, white, #b2dcff);
    min-width: 1600px;
    width: 1600px;
  }
  .titleRow {
    height: 6rem;
    background-color: darkgrey;
    text-align: left;
  }
  .btn {
    margin: 1px;
  }
  .button {
    /* nothing yet */
  }
  .navigationButton {
    font-size: 2rem;
    background-color: darkgrey;
  }
  .navigationButton:disabled {
    /* nothing yet */
  }
  .navigationButton:enabled {
    background-color: #8cbdea;
    font-size: 2rem;
  }
  .navigationButton:hover:enabled {
    animation: glowButton 0s ease-in-out;
    animation-fill-mode: forwards;
  }
  @-webkit-keyframes glowButton {
    100% { box-shadow: 0 0 10px #fff, 0 0 20px #fffd7c, 0 0 30px #e6bb12 }
  }
  .pX-navigationTopRow {
    height: 14rem;
  }
  .pX-navigationCol {
    border: 0px solid red;
    min-width: 22rem;
    vertical-align: top;
    padding-top: 15rem;
  }

  /* ------------- */
  /* Page 1 Styles */
  /* ------------- */

  /* START Paired-End-Single-End Slider Entries */

  .p1-contentTableCell {
    border: 0px solid blue;
    width: 100%;
  }
  .p1-contentTable {
    border: 0px solid green;
  }
  /* START Paired-End-Single-End Slider Entries */
  .SPETableRow {
    align: center;
  }
  .SPEInternalRow {
    align: center;
  }
  .switch {
    margin: 0.5rem;
    position: relative;
    display: inline-block;
    width: 60px;
    height: 34px;
  }
  .switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }
  .slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #4b78cc;
    -webkit-transition: .4s;
    transition: .4s;
  }
  .slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    -webkit-transition: .4s;
    transition: .4s;
  }
  input:checked + .slider {
    background-color: #e2b32d;
  }

  input:focus + .slider {
    box-shadow: 0 0 1px #b3adb2;
  }
  input:checked + .slider:before {
    -webkit-transform: translateX(26px);
    -ms-transform: translateX(26px);
    transform: translateX(26px);
  }
  .slider.round {
    border-radius: 34px;
  }

  .slider.round:before {
    border-radius: 50%;
  }
  .switcherLine {
    font-size: 2rem;
  }
  /* END Paired-End-Single-End Slider Entries */

  .p1-titleRow {
    font-size: 2.5rem;
    text-align: center;
    vertical-align: middle;
  }
  .p1-selectionRow {
    border: 0px solid green;
    height: 9rem;
    vertical-align: middle;
    text-align: center;
  }
  .p1-mainRowCell {
    text-align: center;
    vertical-align: middle;
  }
  .p1-preMappingRow {
    border: 0px solid green;
    vertical-align: middle;
    text-align: center;
  }
  .p1-poolRow {
    border: 0px solid green;
    vertical-align: top;
  }
  .moduleField {
    min-width: 16rem;
    min-height: 12rem;
    width: 16rem;
    height: 14rem;
    margin: 1rem auto;
  }
  .moduleFieldGlowing {
    /*padding: 15rem;*/
    animation: glowField 0.2s ease-out, scaleField 0.2s ease-out;
    animation-fill-mode: forwards;
  }
  @-webkit-keyframes glowField {
    100% { box-shadow: inset 0 0 5px #000000, 0 0 10px #fff, 0 0 20px #fffd7c, 0 0 30px #e6bb12 }
  }
  @-webkit-keyframes scaleField {
    100% { transform: scale(1.2) }
  }
  .selection {
    text-align: left;
    border-color: dimgrey;
    /*margin-top: 1rem;*/
  }
  .selectionFalse {
    background-image: linear-gradient(to bottom right, lightgrey, #e56640);
    /*background-color: #e56640;*/
  }
  .selectionTrue {
    background-image: linear-gradient(to bottom right, lightgrey, #8cbdea);
    /*background-color: #d2e5a2; !*4fd998; 4fd953*!*/
  }
  .pool {
    margin: 1rem 1rem;

    width: 20rem;
    height: 20rem;

    background-color: #c7d0de;
    border-color: darkgrey;
    /*margin: 1rem;*/
  }
  .pool:hover {
    background-image: linear-gradient(to bottom right, lightgrey, lightgrey, #fffd7c)
  }
  .p1-moduleButton {
    border: 1px solid #afafaf;
    /*box-shadow: 0 4px 4px 0 rgba(0,0,0,0.2), 0 6px 4px 0 rgba(0,0,0,0.19);*/
    font-size: 1.5rem;
    /*margin: 0.2rem;*/
  }
  .installed {
    background-image: linear-gradient(to bottom, #e4e4e4, darkgrey);
  }
  .noninstalled {
    background-image: linear-gradient(to bottom, #e4e4e4, #efb943);
  }
  .p1-arrowCell {
    vertical-align: middle;
    text-align: center;
  }
  .p1-arrowSymbol {
    color: #4f4f4f;
    font-size: 10rem;
  }
  .p1-PREM-pipelineArrowCurved {
    transform: rotate(90deg)
  }
  .p1-PREM-pipelineArrowCurved-deactivated {
    color: rgba(88, 106, 149, 0.2);
    font-size: 10rem;
    transform: rotate(90deg)
  }
  .p1-backgroundPipelineFalse {
    background-color: rgba(217, 184, 172, 0.8);
  }
  .p1-backgroundPipelineTrue {
    background-color: rgba(161, 190, 210, 0.8);
  }
  .p1-backgroundPipeline-deactivated {
    background-color: rgba(255, 255, 255, 0.2);
  }
  .p1-backgroundPipelinePremappingCurve {
    border-bottom-left-radius: 50px;
    text-align: center;
  }
  .p1-backgroundPipelinePremappingCurve-deactivated {
    background-color: rgba(255, 255, 255, 0.2);
    border-bottom-left-radius: 50px;
    text-align: center;
  }

  /* ------------- */
  /* Page 2 Styles */
  /* ------------- */

  .singleEndHighlight {
    color: #4b78cc;
    font-weight: bold;
  }
  .pairedEndHighlight {
    color: #e2b32d;
    font-weight: bold;
  }
  .moduleWellShadow {
    box-shadow: inset 0 0 5px #000000;
  }
  .p2-contentTableCell {
    width: 100%;
  }
  .p2-groupName {
    text-align: left;
    font-size: 25rem;
  }
  .p2-groupTable {
    width: 100%;
    border-color: darkgrey;
    overflow-x: auto;
    height: 1rem;
  }
  .p2-emptyGroupTable {
    width: 100%;
    border-color: darkgrey;
  }
  .p2-groupTableTitleRow {
    /* nothing yet */
  }
  .p2-groupTableTitleCell {
    height: 3rem;
    font-size: 2rem;
    text-align: center;
  }
  .p2-moduleOptionsTable {
    table-layout: fixed;
    width: 100%;
  }
  .p2-pipelineGroupCol {
    border: 0px solid green;
    padding: 1rem;
    /*width: 30rem;*/
    width: 25%;
    vertical-align: top;
    height: 50rem;
  }
  .p2-pipelineGroupCol:hover {
    width: 60rem;
  }
  .p2-pipelineGroupCol:hover .p2-invisibleContent {
    display: block;
  }
  .p2-pipelineGroupColWrapper {
    min-height: 45rem;
    background-image: linear-gradient(to bottom, rgb(161, 190, 210), rgb(161, 190, 210), rgba(161, 190, 210, 0));
  }
  /*.p2-groupTable:hover {*/
  /*  transform-origin: top;*/
  /*  animation: leaves 0.4s ease-out;*/
  /*  animation-fill-mode: forwards;*/
  /*}*/
  /*@-webkit-keyframes leaves {*/
  /*  100% {transform: scale(2.0);}*/
  /*}*/
  .p2-groupTableContentRow {
    /* nothing yet */
  }
  .p2-groupTableContentCell {
    vertical-align: top;
  }
  .p2-moduleTable {
    width: 100%;
    /*margin: auto;*/
    background-image: linear-gradient(to bottom, #e4e4e4, darkgrey);
  }
  .p2-moduleTableTitle {
    border-bottom: 0px solid dimgrey;
    background-color: lightgrey;
    height: 4.5rem;
    text-align: center;
    font-weight: bold;
    font-size: 18px;
  }
  .p2-moduleTitleFalse {
    /* settingsTypeTitleFalse (stt-false) */
    background-image: linear-gradient(to bottom right, lightgrey, #e56640);
  }
  .p2-moduleTitleTrue {
    /* settingsTypeTitleTrue (stt-true) */
    background-image: linear-gradient(to bottom right, lightgrey, #8cbdea);
  }
  .p2-settingsTypeTitle {
    /*margin-left: 1rem;*/
    text-align: center;
    font-size: 1.5rem;
    font-weight: bold;
    font-style: italic;
  }
  .p2-typeRequiredTitle {
    color: black;
  }
  .p2-typeOptionalTitle {
    color: dimgrey;
  }
  .p2-settingRow {
    height: 2rem;
    margin-top: 0.2rem;
    margin-bottom: 0.2rem;
    size: 1.4rem;
  }
  .p2-invisibleContent {
    display: none;
    color: dimgrey;
  }
  .p2-settingRowContent {

  }
  .p2-settingRowType-A {
    background-color: darkgrey;
  }
  .p2-settingRowType-B {
    background-color: lightgrey;
  }
  .p2-settingRowType-A:hover {
    background-image: linear-gradient(to bottom right, darkgrey, #fffd7c)
  }
  .p2-settingRowType-B:hover {
    background-image: linear-gradient(to bottom right, lightgrey, #fffd7c)
  }
  .p2-nameCell {
    width: 40%;
    font-weight: bold;
  }
  /*.p2-requiredNameCell {*/
  /*  font-color: dimgrey;*/
  /*}*/
  /*.p2-optionalNameCell {*/
  /*  font-color: dimgrey;*/
  /*}*/
  .p2-inputCell {
    width: 60%;
    /*border: 1px solid green;*/
  }
  .p2-optionalNameCell {
    color: dimgrey;
  }
  .p2-settingsInput {
    width: 95%;
  }
  .p2-enumSettingsInput {
  }
  .p2-descriptionSymbol:hover {
    color: #2f87ff;
  }

  /* ------------- */
  /* Page 3 Styles */
  /* ------------- */

  .p3-contentTableCell {
    width: 100%;
  }
  .page3Table {
    min-width: 20rem;
    max-width: 40rem;
  }
  .p3-clickForHighlighting {
    user-select: all;
  }
  .p3-mainTableWell {
    background-image: linear-gradient(to bottom, rgb(161, 190, 210), rgb(161, 190, 210), rgba(161, 190, 210, 0));
    background-color: rgba(255, 255, 255, 0);
    border: rgba(255, 255, 255, 0);
  }
  .p3-mainTable {
    width: 100%;
  }
  .p3-mainTableCell {
  }
  .p3-finalYamlWell {
    width: 75rem;
    text-align: left;
    margin: 1rem auto;
  }
  .p3-buttonGroup {
    vertical-align: top;
    padding-top: 15rem;
  }
</style>

<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script>
  var app = new Vue({
    el: '#app',
    data: {
      message: {
        testvalue1: '',
        testvalue2: ''
      },
      storedSelectionKeys: ['groupName', 'groupShowName', 'groupId', 'groupMax', 'groupMin', 'selectionAmount', 'selectionAcceptability'],
      storedGroupsNames: ['preprocessing', 'premapping', 'mapping', 'analyses'],
      storedModuleGroups: [
        // order of dictionaries = order of groups on HTML page
        // main storage for module group information
        // ** add new module groups here **
        {
          groupName: 'preprocessing',
          groupShowName: 'Preprocessing',
          groupOptional: true,
          groupMin: 0,
          groupMax: 1
        },
        {
          groupName: 'premapping',
          groupShowName: 'Premapping',
          groupOptional: true,
          groupMin: 0,
          groupMax: null
        },
        {
          groupName: 'mapping',
          groupShowName: 'Mapping',
          groupOptional: false,
          groupMin: 1,
          groupMax: 1
        },
        {
          groupName: 'analyses',
          groupShowName: 'Analyses',
          groupOptional: true,
          groupMin: 0,
          groupMax: null
        }
      ],
      storedJsonList: jsonData,
      collectedModules: null,
      dynamicGroupList: null,
      finalYaml: null,
      pairedEnd: false,
      page1: true,
      page2: false,
      page3: false,
      page1Acceptability: false,
      page2Acceptability: false,
      page3Acceptability: false
    },
    methods: {
      changeEnd () {
        if (this.pairedEnd === true) {
          this.pairedEnd = false
        } else {
          this.pairedEnd = true
        }
      },
      generateId (type, index) {
        let id = type + '--' + index
        return id
      },
      createDynamicGroupList () {
        // Setting up the main storage for groups, their modules and information
        let mainList = []
        let counter = 0

        for (let entry of this.storedModuleGroups) {
          // group = analyses / mapping etc.
          let tempDict = this.createTempDict(entry, counter)

          mainList.push(tempDict)
          counter = counter + 1
        }
        console.log(mainList)
        this.dynamicGroupList = mainList
      },
      createTempDict (entry, counter) {
        // group = analyses / mapping etc.
        let tempDict = {}
        tempDict['groupName'] = entry.groupName
        tempDict['groupShowName'] = entry.groupShowName
        tempDict['groupId'] = entry.groupName + '--' + counter
        tempDict['groupIndex'] = counter
        tempDict['groupMax'] = entry.groupMax
        tempDict['groupMin'] = entry.groupMin
        tempDict['groupOptional'] = entry.groupOptional
        tempDict['groupHovered'] = false
        tempDict['groupChosen'] = false
        tempDict['selectionAcceptability'] = false
        tempDict['selectionAmount'] = 0
        // Inserting modules via refinedModules function
        tempDict['modules'] = this.refinedModuleList(entry, counter)
        return (tempDict)
      },
      refinedModuleList (entry, counter) {
        let moduleList = this.storedJsonList[entry.groupName]['modules']
        for (let moduleDict of moduleList) {
          moduleDict['id'] = moduleDict['name'] + '--' + counter
          moduleDict['groupName'] = entry.groupName
          moduleDict['groupIndex'] = counter
          moduleDict['showRequiredSettings'] = true
          moduleDict['showOptionalSettings'] = false
        }
        return (moduleList)
      },
      checkModuleAcceptability () {
        let moduleList = this.collectedModules
        for (let group of moduleList) {
          for (let module of group.modules) {
            let tempAcceptability = true
            if (module.settings) {
              for (let rOption of module.settings.required) {
                let regexResult = this.zeroContentCheck(rOption.value)

                if (regexResult === null) {
                  tempAcceptability = false
                }
              }
            }
            module.Acceptability = tempAcceptability
          }
        }
      },
      checkPage1Acceptability() {
        let mainList = this.dynamicGroupList
        let page1Acceptability = true
        for (let entry of mainList) {
          let focusedValue = 'selectionAcceptability'

          this.checkAmountRange(entry, focusedValue)
          try {
            // when selections are present
            changeSelectedAmount(entry.groupIndex)
          } catch {
            // pass, when selection fields (and therefore their children) are not present
          }

          if (entry[focusedValue] === false) {
            page1Acceptability = false
          }
        }
        this.page1Acceptability = page1Acceptability
      },
      checkAmountRange (entry, focusedValue) {
        if (entry.groupMax === null) {
          if (entry.selectionAmount >= entry.groupMin) {
            entry[focusedValue] = true
          } else {
            entry[focusedValue] = false
          }
        } else {
          if (entry.selectionAmount >= entry.groupMin && entry.selectionAmount <= entry.groupMax) {
            entry[focusedValue] = true
          } else {
            entry[focusedValue] = false
          }
        }
      },
      checkPage2Acceptability () {
        let groupList = this.collectedModules
        let page2Acceptability = true

        for (let group of groupList) {
          if (group.moduleAmount > 0) {
            let moduleList = group.modules

            for (let module of moduleList) {
              if (module.Acceptability === false) {
                page2Acceptability = false
              }
            }
          }
        }
        this.page2Acceptability = page2Acceptability
      },
      prepareFinalYaml () {
        let finalYaml = {
          pipeline: {
            paired_end: this.pairedEnd
          }
        }
        let groupList = this.collectedModules

        for (let group of groupList) {
          if (group.moduleAmount > 0) {
            finalYaml[group.groupName] = this.prepareGroupList(group)
          } else {
            finalYaml[group.groupName] = {
              module: '',
            }
          }
        }

        this.finalYaml = finalYaml
      },
      prepareGroupList (group) {
        let tempGroupDict = {}

        if (group.groupName === 'mapping') {
          tempGroupDict['module'] = group.modules[0].name
        } else {
          let tempModuleList = []
          for (let module of group.modules) {
            tempModuleList.push(module.name)
          }
          tempGroupDict['modules'] = tempModuleList
        }

        tempGroupDict = this.prepareModuleList(tempGroupDict, group)

        return (tempGroupDict)
      },
      prepareModuleList (groupDict, group) {
        let modules = group.modules

        for (let module of modules) {
          let tempSettingsDict = {}
          let settings = module.settings
          for (let settingsType in settings) {
            for (let setting of settings[settingsType]) {
              let regexResult = this.zeroContentCheck(setting.value)
              if (regexResult !== null) {
                tempSettingsDict[setting.name] = setting.value
              }
            }
          }
          groupDict[module.name] = tempSettingsDict
        }

        return (groupDict)
      },
      zeroContentCheck (string) {
        let regex = RegExp('\\w')
        let check = string.match(regex)

        return (check)
      },
      changeShowOptionalSettings (module) {
        console.log(module.showOptionalSettings)
        if (module.showOptionalSettings === true) {
          module.showOptionalSettings = false
        } else {
          module.showOptionalSettings = true
        }
      },
      switchPage(targetPage) {
        let pageList = ["page1", "page2", "page3"]
        for (let pageElement of pageList) {
          VUE[pageElement] = false
        }
        VUE[targetPage] = true
      }
    },
    beforeMount () {
      console.log('>>> beforeMount')
      this.createDynamicGroupList()
    },
    mounted () {
      console.log('>>> mounted')
      this.checkPage1Acceptability()
    },
    updated () {
      console.log('>>> updated')
      if (this.page1 === true) {
        this.checkPage1Acceptability()
      }
      if (this.page2 === true) {
        this.checkModuleAcceptability()
        this.checkPage2Acceptability()
      }
    }
  })

  let VUE = app._data

  function collectModules () {
    // main function for collecting the chosen modules (= all modules in the pools)
    // function is running through the module groups storage (storedModuleGroups)
    // current pool = storedModuleGroups[<index>] => <group-name> + '_' + <index> (e.g. "analyses_3")
    let tempList = []
    let counter = 0
    for (let group of VUE.storedModuleGroups) {
      let tempDict = {}

      tempDict['groupName'] = group.groupName
      tempDict['groupId'] = group.groupName + '--' + counter
      tempDict['groupNumber'] = counter
      tempDict['groupAcceptability'] = false
      tempDict['modules'] = []

      let modules = getDomModules(counter)
      let moduleCounter = 0
      for (let module of modules) {
        let tempModuleDict = {}
        let moduleId = module.id
        let nameParts = moduleId.split('--')
        let moduleName = nameParts[0]
        let moduleSection = nameParts[1]

        tempModuleDict['name'] = moduleName
        tempModuleDict['showRequiredSettings'] = true
        tempModuleDict['showOptionalSettings'] = false
        tempModuleDict['settings'] = returnOptions(moduleSection, moduleName)
        tempModuleDict['Acceptability'] = false

        tempDict['modules'].push(tempModuleDict)
        moduleCounter = moduleCounter + 1
      }
      tempDict['moduleAmount'] = moduleCounter
      tempList.push(tempDict)
      counter = counter + 1
    }
    VUE.collectedModules = tempList
  }
  function getDomModules (counter) {
    let selectionId = 'selection--' + counter
    let selectionField = document.getElementById(selectionId)
    let modules = selectionField.children
    return (modules)
  }
  function returnOptions (section, moduleName) {
    let intSection = parseInt(section)
    let moduleList = VUE.dynamicGroupList[intSection].modules
    let options = null
    for (let module of moduleList) {
      if (module.name === moduleName) {
        try {
          options = module.settings
        } catch {
          console.log('ERROR: Could not find any options in ' + module.name)
        }
      }
    }
    return (options)
  }
	function allowDrop(ev) {
		ev.preventDefault();
	}
	function forbidDrop(ev) {
    ev.dataTransfer.dropEffect = "none"
	}
	function drag(ev) {
    console.log(' >>> drag')

    let namePartsList = returnNameAndSection(ev.target.id)
    let sectionCount = namePartsList[1]

    if (ev.path[1].id.startsWith('pool')) {
      VUE.dynamicGroupList[sectionCount]['groupChosen'] = true
    }

    ev.dataTransfer.setData("elementId", ev.target.id);
	}
  function returnNameAndSection (nonString) {
    console.log(' >>> returnNameAndSection')

    let string = nonString.toString()
    let namePartsList = string.split('--')
    let rawInt = parseInt(namePartsList[1])
    namePartsList[1] = parseInt(rawInt)


    return(namePartsList)
  }
	function dropSection(ev) {
    console.log(' >>> dropSection')

    app.checkPage1Acceptability()

    ev.preventDefault();
    let dragged = ev.dataTransfer.getData("elementId");
    // let namePartsList = returnNameAndSection(ev.target.id)

    let targetId = ev.target.id
    let namePartsList = returnNameAndSection(targetId)
    let sectionCount = namePartsList[1]

    if (dragged.endsWith(sectionCount)) {
      ev.target.appendChild(document.getElementById(dragged));
    }
    changeSelectedAmount(sectionCount)
	}
  function changeSelectedAmount (section) {
    let selectionId = 'selection--' + section
    let selection = document.getElementById(selectionId)
    let amount = selection.children.length
    VUE.dynamicGroupList[section].selectionAmount = amount
  }

  function dragEnd (ev) {
    console.log(' >>> drag END')
    let targetId = ev.target.id
    let namePartsList = returnNameAndSection(targetId)
    let sectionCount = namePartsList[1]

    VUE.dynamicGroupList[sectionCount]['groupChosen'] = false
    app.checkPage1Acceptability()
  }

  function copyToClipboard() {
    let range = document.createRange()
    range.selectNode(document.getElementById("yamlTextWell"))

    window.getSelection().removeAllRanges()

    window.getSelection().addRange(range)
    document.execCommand("copy")
  }
  function download(rawData, filename, type) {
    // let data = JSON.stringify(rawData)

    let data = document.getElementById("yamlTextWell").innerText

    let file = new Blob([data], {type: type});
    if (window.navigator.msSaveOrOpenBlob) // IE10+
      window.navigator.msSaveOrOpenBlob(file, filename);
    else { // Others
      let a = document.createElement("a"),
        url = URL.createObjectURL(file);
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      setTimeout(function() {
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
      }, 0);
    }
  }
</script>