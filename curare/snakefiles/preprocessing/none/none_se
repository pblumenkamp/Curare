from os import listdir
from os.path import isfile, dirname

def getPath(sample):
    if config['entries'][sample]['main']['reads']:
        return config['entries'][sample]['main']['reads']

rule all:
    input: 
        expand("preprocessing/{sample}.fastq.gz", sample=config['entries'].keys())

rule gzip_files:
    input:
        lambda wildcards: getPath(wildcards.sample)
    output:
        "preprocessing/{sample, [^.]+}.{extension}"
    threads:
        1
    shell:
        """
        if file "{input}" | grep -q "gzip compressed"; then
            ln `readlink -f "{input}"` "{output}"
        else
            gzip -c "{input}" > "{output}"
        fi
        """